# Диодные часы
![Здесь должно быть фото часов!](https://github.com/tokelau/mobile_robots/blob/master/chasy.jpg)
## Предыстория
Мы не ставили себе целью создать оригинальный по своему содержанию проект, основным критерием для нас был наш собственный интерес. Первыми похожий проект реализовала группа венских дизайнеров, и интерес заключался в том, чтобы создать максимально идентичные часы. Мы хотели узнать, насколько нам удастся разобраться в принципе работы и создать нечто похожее, потому что разработчики (дизайнеры) не выложили подробного описания, только видео с демонстрацией работы. Кажется не так сложно. 
## Задачи
В первую очередь нужно было понять, как должны быть устроены наши часы. Каждому диоду нужно было дать возможность хранить свое состояние, для этого используют регистры. Так как нам нужно 8 регистров (по 8 разрядов в каждом), эти регистры тоже нужно как-то адресовать. Для этого в схеме нужен дешифратор и два 8 разрядных сдвиговых регистра, соединённых каскадом. 
Следующая задача - обеспечить питание. На вход мы подавали 12 вольт, рабочее напряжение логических элементов 5 вольт, а диодов - 3 вольта. Для перехода с 12 вольт на 5 мы использовали стабилизатор SN74HC05N. Для питания диодов использовали принцип деления напряжения, подключив два диода последовательно.

Теоретические задачи решены. Практически нужно было научиться работать с модулем часов, аккуратно спаять все детали, раздобыть подходящий корпус и достаточное количество проводов, затем придумать, как все закрепить.
## Hardware

![Фото с деталями](https://github.com/tokelau/mobile_robots/blob/master/details.jpg)

Итак, детали для проекта нам понадобились следующие:
* лента из 60 светодиодов
* кнопка
* модуль часов DS1307 (в корпусе dip8)
* стабилизатор КР142ЕН5А с двумя конденсаторами
* инвертор КР1533ЛН1 (x2)
* 8-разрядный регистр-защелка SN74HC573АN (х8)
* инвертор с открытым стоком SN74HC05N (х10)
* сдвиговый регистр 74HC595 (x2)
* дешифратор 3 на 8 КР1533ИД3
* пластиковый корпус
## Схема

Схема подключения модуля времени: 

![Здесь должна быть схема на макетной плате!](https://github.com/tokelau/mobile_robots/blob/master/scheme_bb.jpg)

Принципиальная схема подключения микросхем: 

![Здесь должна быть схема](https://github.com/tokelau/mobile_robots/blob/master/scheme.png)
## Software
Для разработки прошивки мы использовали Arduino IDE. Здесь нам нужно было выполнить две основные задачи: научиться получать время с модуля часов и кодировать его в маску, понятную регистру. Скорость передачи данных мы выставили 57600, так как модуль времени работает именно с такой скоростью.
Код для установки времени выглядит так (запускается один раз): 
```c++
#include <DS1307RTC.h>

tmElements_t te;

void setup() {
  Serial.begin(57600);
  te.Hour = 18;
  te.Minute = 50;
  te.Second = 0;
  te.Day = 20; 
  te.Month = 4; 
  te.Year = CalendarYrToTm(2016); 
  RTC.write(te);
}
```
Теперь мы можем считывать время с модуля:
```c++
RTC.read(te);
int second = te.Second;
int minute = te.Minute;
int hour = te.Hour;
```

Далее функция, которая подсвечивает светодиоды, в зависимости от полученно байта:
```c++
void lightByMask(int RegNum, char LightMask)
{
  Serial.write(LightMask);
  digitalWrite(5, LOW);
  digitalWrite(11, LOW);
  shiftOut(8, 13, MSBFIRST, LightMask);
  shiftOut(8, 13, LSBFIRST, RegNum);
  digitalWrite(11, HIGH);
  digitalWrite(5, HIGH);
}
```
## Трудности
Основные трудности были связаны с тем, что мы не смогли правильно рассчитать свои силы. Схемотехника оказалась несколько более сложной задачей, чем мы думали, нам не хватило опыта для такой работы. После сборки, мы поняли, что шина была спаяна неверно и неправильно передает сигнал. Кроме того, не смотря на наличие опыта работы с паяльником, паять все-таки нужно было очень много и мы потратили на это больше времени, чем ожидали. 
## Заключение
В сумме мы потратили на проект все свое свободное время за несколько недель и более 3-х тысяч рублей. Изначально поставленная задача была достаточно простой, хотя на деле оказалась гораздо сложнее. Мы оказались совершенно не готовы ко многим трудностям, с которыми пришлось разбираться. Но сейчас, спустя несколько мозговых штурмов, мы приобрели опыт в схемотехнике, выпиливаниии деталей ПВХ, а так же в работе с логическими микросхемами, что немаловажно. В будущем планируется доделать эти часы, чтобы затраты на них не ушли в пустую и чтобы все-таки добиться поставленной цели. 
# Спасибо за внимание!
